mongoDB??tgz?? ¶À??
F:\DB\Mongo
???winscp ??? ? ???????????

??????????mongoDB?????????
tar -zxvf <???????????>

?????????????????????????????
??????mongoDB???????mongodb
?????????????????
mkdir data data/db data/log

??mongodb?ß’??????????mongodb.conf
???? vim ./mongodb.conf
?????

# ?????ß’???

sudo chmod 666 data/db data/log

# ?????????????

dbpath=/root/mongo/data/db

# ???????????

logpath=/root/mongo/data/log/mongodb.log

# ????????

logappend=true

# ???

port=27017

# ??????

auth=true

# ???????????????????

fork=true

# ???????????ip??????????????0.0.0.0??????????ip????

bind_ip=0.0.0.0
#???????????
maxConns = 5
#???ß’????????????????????journal????????????ß’??????????
journal = true
#??? ç™ ????????wiredtiger??????????????????¶≈?checkpoint? ? ???????????journal??????????
storageEngine = wiredTiger #? õ• ??????mmapv1??wiretiger??mongorocks

???????
??
sudo vim /etc/profile
?¶¬?????????
export MONGODB_HOME=/root/mongo
export PATH=$PATH:$MONGODB_HOME/bin
????profile???

# ???????????

mongod -f /usr/local/mongodb/mongodb.conf

# ????mongo ---mongo

???°¬????
systemctl status firewalld ?????????
systemctl start firewalld ?????????

# ????27017 ???

sudo firewall-cmd --zone=public --add-port=27017/tcp --permanent

# ?°¬??????????ßπ

sudo firewall-cmd --reload

# ??????????????????

sudo firewall-cmd --zone=public --list-ports

????????

# mongodb ??????

ps aux | grep mongo

# ??????????

netstat -lamp | grep 27017

# ???netstat??????????????netstat

yum install -y net-tools

??????

# ???????ID???

# ???mongod??????mongodb????

mongod -f /home/mongodb/mongodb/mongo.conf

???????????
vim /lib/systemd/system/mongodb.service
??????????????
[Unit]
Description=mongodb
After=network.target remote-fs.target nss-lookup.target
[Service]
Type=forking
ExecStart=/root/mongo/bin/mongod -f /root/mongo/mongodb.conf
ExecReload=/bin/kill -s HUP $MAINPID
ExecStop=/root/mongo/bin/mongod -f /root/mongo/mongodb.conf --shutdown
PrivateTmp=true
[Install]
WantedBy=multi-user.target

??????????????????
????
systemctl start mongodb.service
????
systemctl status mongodb.service
? ⁄Ö ????????
systemctl enable mongodb.service
??????????mongodb.service
systemctl daemon-reload

???????????mongoDB????
????

1. mongo
   ???????
2. use admin
   db.createUser({user:"root",pwd:"",roles:[{role:"userAdminAnyDatabase",db:"admin"}]})
   Successfully added user: {
   "user" : "root",
   "roles" : [
   {
   "role" : "userAdminAnyDatabase",
   "db" : "admin"
   }
   ]
   }
3. > use admin
   > switched to db admin
   > show tables
   > Warning: unable to run listCollections, attempting to approximate collection names by parsing connectionStatus

# ???

> db.auth("root","")
> 1
> show tables
> system.users
> system.version

?????????????????????????????
db.createUser({user:'PJMVSSM',pwd:'',roles:[{role:'readWrite',db:'nobody'}]})

> use nobody
> switched to db nobody
> db.createUser({user:'PJMVSSM',pwd:'',roles:[{role:'readWrite',db:'nobody'}]})
> Successfully added user: {

        "user" : "PJMVSSM",
        "roles" : [
                {
                        "role" : "readWrite",
                        "db" : "nobody"
                }
        ]

}
??????????????????mongodb?????mongoDBCompass

#### ??????

TLS/SSL is disabled. If possible, enable TLS/SSL to avoid security vulnerabilities.
???????????????????ssl

### ???¶ƒ???

# ???????????

## ???????????????

### ????????

openssl req -out ca.pem -new -x509 -days 3650

### ??????

openssl req -out ca.pem -new -x509 -days 3650 -subj "/C=CN/ST=BeiJing/O=bigdata/CN=server1/CN=yellowcong/emailAddress=yellowcong@qq.com"

### ??????

[wymusic@ ssl]$ ls
ca.pem privkey.pem

## ??????? ???????????

### ?????????????

openssl genrsa -out server.key 2048

### ?????????????????? cat server.req

/**
#CN=localhost ??mongo???????ß÷????????????????????????
\*/
openssl req -key server.key -new -out server.req
/** -subj "/C=CN/ST=JS/O=bigdata/CN=server1/CN=localhost/emailAddress=2298930148@qq.com"
\*/

### ??????????????

openssl x509 -req -in server.req -CA ca.pem -CAkey privkey.pem -CAcreateserial -out server.crt -days 3650

### ???????????????????????? ÔÖ ????server.pem

cat server.key server.crt > server.pem

### ßµ?????????pem???

openssl verify -CAfile ca.pem server.pem

### ??????

[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ openssl x509 -req -in server.req -CA ca.pem -CAkey privkey.pem -CAcreateserial -out server.crt -days 3650
Signature ok
subject=C = CN, ST = JS, O = bigdata, CN = server_mongodb, CN = localhost, emailAddress = 2298930148@qq.com
Getting CA Private Key
Enter pass phrase for privkey.pem:
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ cat server.key server.crt > server.pem
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ openssl verify -CAfile ca.pem server.pem
server.pem: OK

## ????????????????????

### ??????????

openssl genrsa -out client.key 2048

### ???????????????

#CN=localhost ??mongo???????????????????????????????????????
openssl req -key client.key -new -out client.req -subj "/C=CN/ST=JS/O=bigdata/CN=server1/CN=localhost/emailAddress=2298930148@qq.com"

### ???????????

openssl x509 -req -in client.req -CA ca.pem -CAkey privkey.pem -CAserial ca.srl -out client.crt -days 3650

### ?????????????????? ÔÖ ????client.pem

cat client.key client.crt > client.pem

### ßµ??????pem???

openssl verify -CAfile ca.pem client.pem

### ???????

[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ openssl genrsa -out client.key 2048
Generating RSA private key, 2048 bit long modulus (2 primes)
...............+++++
........+++++
e is 65537 (0x010001)
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ ls
ca.pem client.key server.crt server.pem
ca.srl privkey.pem server.key server.req
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ openssl req -key client.key -new -out client.req -subj "/C=CN/ST=JS/O=bigdata/CN=server1/CN=localhost/emailAddress=2298930148@qq.com"
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ ls
ca.pem client.key privkey.pem server.key server.req
ca.srl client.req server.crt server.pem
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ openssl x509 -req -in client.req -CA ca.pem -CAkey privkey.pem -CAserial ca.srl -out client.crt -days 3650
Signature ok
subject=C = CN, ST = JS, O = bigdata, CN = server1, CN = localhost, emailAddress = 2298930148@qq.com
Getting CA Private Key
Enter pass phrase for privkey.pem:
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ cat client.key client.crt > client.pem
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ openssl verify -CAfile ca.pem client.pem
client.pem: OK
[wymusic@iZuf6g411frzx7ezcnnv92Z ssl]$ ls -al
total 40
drwxrwxr-x 2 wymusic wymusic 197 Jan 16 22:20 .
drwx------ 4 wymusic wymusic 160 Jan 16 21:15 ..
-rw-rw-r-- 1 wymusic wymusic 1371 Jan 16 21:03 ca.pem
-rw-rw-r-- 1 wymusic wymusic 41 Jan 16 22:20 ca.srl
-rw-rw-r-- 1 wymusic wymusic 1249 Jan 16 22:20 client.crt
-rw------- 1 wymusic wymusic 1679 Jan 16 22:19 client.key
-rw-rw-r-- 1 wymusic wymusic 2928 Jan 16 22:20 client.pem
-rw-rw-r-- 1 wymusic wymusic 1021 Jan 16 22:20 client.req
-rw------- 1 wymusic wymusic 1854 Jan 16 21:02 privkey.pem
-rw-rw-r-- 1 wymusic wymusic 1261 Jan 16 22:15 server.crt
-rw------- 1 wymusic wymusic 1675 Jan 16 21:06 server.key
-rw-rw-r-- 1 wymusic wymusic 0 Jan 16 22:16 server.pem
-rw-rw-r-- 1 wymusic wymusic 1029 Jan 16 21:30 server.req

# ???°¬????

## ?????????? mongodb.conf

1. cat <<EOF > /home/wymusic/mongodb/mongodb/mongodb.conf
2. ??????????
   #?????????????
   dbpath = /home/wymusic/mongodb/mongodb/data/db
   #???????????
   logpath = /home/wymusic/mongodb/mongodb/data/log/mongodb.conf
   #????????
   logappend = true
   #???
   port = 27017
   #??????
   auth = true
   #????????????????????
   fork = true
   #??????????ip???????????????? ? ??????
   bind_ip = 0.0.0.0
   #???????????
   maxConns = 5
   #???ß’????????????????????journal????????????ß’??????????
   journal = true
   #??? ç™ ????????wiredtiger??????????????????¶≈?checkpoint? ? ???????????journal??????????
   storageEngine = wiredTiger #? õ• ??????mmapv1??wiretiger??mongorocks
   Shell
   mongo --sslAllowInvalidCertificates --sslAllowInvalidHostnames --ssl --sslPEMKeyFile /usr/local/mongo/ssl/client.pem --sslCAFile /usr/local/mongo/ssl/ca.pem --host 127.0.0.1

# ????????°¬???

## ??????°¬??????

???ss5 ?????????
yum install gcc openldap-devel pam-devel openssl-devel
?????????????ss5
wget https://sourceforge.net/projects/ss5/files/ss5/3.8.9-8/ss5-3.8.9-8.tar.gz
??????
tar zxvf ./ss5-3.8.9-8.tar.gz

# ???????ßﬂ?????????????????????????????????????????????ßµ?????????????????????????ß÷???

???????
mongodb://PJMVSSM:**\*\***@IP:PORT/?authSource=nobody&readPreference=primary&directConnection=true&ssl=false
